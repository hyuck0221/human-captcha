# Human-to-Human CAPTCHA (H2H-CAPTCHA)

> **“由真人进行、为真人设计的实时验证”**

H2H-CAPTCHA 是一种创新的安全解决方案，它将传统的自动化图灵测试（如识别红绿灯）替换为实时的真人互动。用户（“客户端”）与真人验证者（“验证者”）配对，完成互动任务。

---

## 🏗 系统架构

该系统基于 **Spring Boot** 和 **WebSockets** 的稳健事件驱动架构构建。

### 1. 后端 (Kotlin + Spring Boot)
-   **WebSocket (STOMP)**: 处理实时双向通信。
-   **匹配服务 (Matching Service)**:
    -   分别为客户端和验证者维护队列。
    -   执行即时的 1:1 匹配。
    -   管理会话生命周期（连接、断开、超时）。
-   **内存管理**: 为确保速度和隐私，所有数据均在内存（`ConcurrentHashMap`）中处理，不进行个人数据持久化。

### 2. 前端 (Vanilla JS + HTML5)
-   **屏幕镜像**:
    -   捕获客户端的鼠标坐标和屏幕分辨率。
    -   验证者的仪表板会根据客户端的宽高比动态调整大小，确保像素级的精确观察。
-   **互动画布**:
    -   双坐标系统：同时发送全屏相对坐标（Global）和画布相对坐标（Local），确保在不同屏幕尺寸下绘画同步的准确性。

---

## 🎮 互动挑战

系统支持由验证者控制的四种验证模式：

1.  **🖱️ 鼠标追踪 (被动验证)**
    -   **逻辑**: 验证者观察客户端自然的鼠标移动。
    -   **目标**: 检测机器人特有的直线移动或瞬间移动。

2.  **✏️ 绘画 (主动验证)**
    -   **逻辑**: 验证者指定一个主题（如“苹果”），客户端在画布上绘画。
    -   **目标**: 验证人类的创造力和精细动作控制能力。

3.  **👊 石头剪刀布 (反应速度验证)**
    -   **逻辑**: 验证者先出拳（如“石头”），引导客户端出能赢的拳（“布”）。
    -   **目标**: 测试对规则的理解和认知反应。

4.  **💬 实时聊天 (图灵测试)**
    -   **逻辑**: 自由格式的文本对话，包含实时的“正在输入...”指示器。
    -   **目标**: 通过高级语言交互进行最终验证。

---

## 🚀 快速入门

### 环境要求
-   **Java 21** (或 Docker)
-   确保 8080 端口可用

### 使用 Docker 运行 (推荐)
```bash
docker-compose up --build
```

### 手动运行
```bash
./gradlew bootRun
```

### 使用说明
1.  访问 `http://localhost:8080`。
2.  **标签页 1**: 选择 **“我是用户 (Client)”**。
3.  **标签页 2**: 选择 **“我是验证者 (Validator)”**。
4.  系统将立即进行匹配。
5.  使用验证者控制台切换任务并验证客户端。

---

## 🛡️ 安全特性
-   **基于 UUID 的路由**: 每个会话创建唯一的临时 UUID 用于安全消息路由。使用 `localStorage` 确保在刷新页面后身份保持一致，从而使黑名单功能生效。
-   **隔离性**: 客户端之间无法互相通信。
-   **隐私保护**: 不记录 IP，不进行持久化存储。数据仅在活动 WebSocket 会话期间存在。

---
© 2025 H2H Captcha Project.
